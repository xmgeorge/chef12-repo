{
  "name": "gluster",
  "description": "Installs and configures Gluster servers and clients",
  "long_description": "# gluster Cookbook\n\n[![Build Status](https://travis-ci.org/shortdudey123/chef-gluster.svg)](https://travis-ci.org/shortdudey123/chef-gluster)\n[![Cookbook Version](https://img.shields.io/cookbook/v/gluster.svg)](https://supermarket.chef.io/cookbooks/gluster)\n\nThis cookbook is used to install and configure Gluster on both servers and clients. This cookbook makes several assumptions when configuring Gluster servers:\n\n1. This cookbook is being run on at least two nodes, the exact number depends on the Gluster Volume type\n2. A second physical disk has been added, unformatted, to the server. This cookbook will install lvm and configure the disks automatically.\n3. All peers for a volume will be configured with the same number of bricks\n\n## Platforms\n\nThis cookbook has been tested on:\n- Ubuntu 14.04\n- Ubuntu 16.04\n- Centos 6.8\n- Centos 7.2\n\nAs this cookbook uses Semantic Versioning, major version number bumps are not backwards compatible. Especially the change from v4 to v5 will require a rebuild of the gluster nodes.\n\n## Attributes\n\n### gluster::default\n- `node['gluster']['version']` - version to install, defaults to 3.8\n- `node['gluster']['repo']` - repo to install from: can be public or private, defaults to public, private requires a so-called \"private\" repo to be configured in a wrapper cookbook for example\n\n### gluster::client\nNode attributes to specify volumes to mount. This has been deprecated in favor of using the 'gluster_mount' LWRP.\n\n- `node['gluster']['client']['volumes'][VOLUME_NAME]['server']` - server to connect to\n- `node['gluster']['client']['volumes'][VOLUME_NAME]['backup_server']` - name of the backup volfile server to mount the client. When the first volfile server fails, then the server specified here is used as volfile server and is mounted by the client. This can be a String or Array of Strings.\n- `node['gluster']['client']['volumes'][VOLUME_NAME]['mount_point']` - mount point to use for the Gluster volume\n\n### gluster::server\nNode attributes to specify server volumes to create\n\nThe absolute minimum configuration is:\n- `node['gluster']['server']['disks']` - an array of disks to create partitions on and format for use with Gluster, (for example, ['/dev/sdb', '/dev/sdc'])\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['peers']` - an array of FQDNs for peers used in the volume\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['volume_type']` - the volume type to use; this value can be 'replicated', 'distributed-replicated', 'distributed', 'striped' or 'distributed-striped'\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['size']` - The size of the gluster volume you would like to create, for example, 100M or 5G. This is passed through to the lvm cookbook and uses the syntax defined here: https://github.com/chef-cookbooks/lvm .\n\n### gluster::geo_replication\nNode attributes to specify mountbroker details.\n\n- `node['gluster']['mountbroker]['path']` - The mountbroker path. Defaults to `/var/mountbroker-root`. This does not need to exist beforehand.\n- `node['gluster']['mountbroker]['group']` - The mountbroker group. Defaults to `geogroup`. This will be created as a system group if it does not exist already.\n- `node['gluster']['mountbroker]['users']` - A hash of users to volumes for allowing access. Empty by default. Multiple volumes can be given as an array. Neither the user or volume needs to exist beforehand. Removing entries does not drop access rights, this must be done manually or via the custom resource.\n\nOther attributes include:\n- `node['gluster']['server']['enable']` - enable or disable server service (default enabled)\n- `node['gluster']['server']['server_extend_enabled']` - enable or disable server extending support (default enabled)\n- `node['gluster']['server']['brick_mount_path']` - default path to use for mounting bricks\n- `node['gluster']['server']['disks']` - an array of disks to create partitions on and format for use with Gluster, (for example, ['/dev/sdb', '/dev/sdc'])\n- `node['gluster']['server']['peer_retries']` - attempt to connect to peers up to N times\n- `node['gluster']['server']['peer_retry_delays']` - number of seconds to wait between attempts to initially attempt to connect to peers\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['allowed_hosts']` - an optional array of IP addresses to allow access to the volume\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['peer_names']` - an optional array of Chef node names for peers used in the volume\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['peers']` - an array of FQDNs for peers used in the volume\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['quota']` - an optional disk quota to set for the volume, such as '10GB'\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['replica_count']` - the number of replicas to create\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['volume_type']` - the volume type to use; this value can be 'replicated', 'distributed-replicated', 'distributed', 'striped' or 'distributed-striped'\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['size']` - The size of the gluster volume you would like to create, for example, 100M or 5G. This is passed through to the lvm cookbook.\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['filesystem']` - The filesystem to use. This defaults to xfs.\n- `node['gluster']['server']['volumes'][VOLUME_NAME]['options']` - Optional options to configure on volume\n\n## Custom Resources\n\n### gluster_volume\n\nUse this resource to start, stop, or delete volumes:\n\n```ruby\ngluster_volume 'volume_name' do\n  action :start\nend\n```\n\n```ruby\ngluster_volume 'volume_name' do\n  action :stop\nend\n```\n\n```ruby\ngluster_volume 'volume_name' do\n  action :delete\nend\n```\n\nIt is also useful for checking existence in `only_if` blocks:\n\n```ruby\nvolume = gluster_volume 'volume_name' do\n  action :nothing\nend\n\nsome_resource 'foo' do\n  only_if { volume.current_value }\nend\n```\n\n```ruby\ngluster_volume 'volume_name' do\n  action :start\n  only_if { current_value }\nend\n```\n\n#### Parameters\n\n- `volume_name` - The volume name. Defaults to the resource name.\n\n### gluster_mount\n\nUse this resource to mount volumes on clients:\n\n```ruby\ngluster_mount 'volume_name' do\n  server 'gluster1.example.com'\n  backup_server 'gluster2.example.com'\n  mount_point '/mnt/gluster/volume_name'\n  action [:mount, :enable]\nend\n```\n\n```ruby\ngluster_mount 'volume_name' do\n  server 'gluster1.example.com'\n  backup_server ['gluster2.example.com', 'gluster3.example.com']\n  mount_point '/mnt/gluster/volume_name'\n  action [:mount, :enable]\nend\n```\n\n#### Parameters\n\n- `server` - The primary server to fetch the volfile from. Required.\n\n- `backup_server` - Backup servers to obtain the volfile from. Optional.\n\n- `mount_point` - The mount point on the local server to mount the glusterfs volume on. Created if non-existing. Required.\n\n- `mount_options` - Additional mount options added to the default options set `defaults,_netdev`. Optional.\n\n- `owner` - Owner of the underlying mount point directory. Defaults to `nil`. Optional.\n\n- `group` - Group of the underlying mount point directory. Defaults to `nil`. Optional.\n\n- `mode` - File mode of the underlying mount point directory. Defaults to `nil`. Optional.\n\n### gluster\\_volume\\_option\n\nUse this resource to set or reset volume options:\n\n```ruby\ngluster_volume_option 'volume_name/changelog.rollover-time' do\n  value 5\n  action :set\nend\n```\n\n```ruby\ngluster_volume_option 'volume_name/changelog.rollover-time' do\n  action :reset\nend\n```\n\n#### Parameters\n\n- `key` - Volume option to change. Required. Derived from after the `/` of resource name if not given.\n- `value` - The value to set for the given option. Required for the set action. Booleans are mapped to `on` or `off`.\n- `volume` - Volume to chnage. Required. Derived from before the `/` of resource name if not given.\n\n### gluster\\_mountbroker\\_user\n\nUse this resource to allow or disallow the given user access to the given volume:\n\n```ruby\ngluster_mountbroker_user 'user/volume_name' do\n  action :add\nend\n```\n\n```ruby\ngluster_mountbroker_user 'user/volume_name' do\n  action :remove\nend\n```\n\n#### Parameters\n\n- `user` - The user to grant permission to. Required. Derived from before the `/` of resource name if not given.\n- `volume` - The volume to grant the permission for. Required. Derived from after the `/` of resource name if not given.\n\n## Usage\n\nOn two or more identical systems, attach the desired number of dedicated disks to use for Gluster storage. Add the `gluster::server` recipe to the node's run list and add any appropriate attributes, such as volumes to the `['gluster']['server']['volumes']` attribute. If the cookbook will be used to manage disks, add the disks to the `['gluster']['server']['disks']` attribute; otherwise format the disks appropriately and add them to the `['gluster']['server']['volumes'][VOLUME_NAME]['disks']` attribute. Once all peers for a volume have configured their bricks, the 'master' peer (the first in the array) will create and start the volume.\n\nFor example, to create a replicated gluster volume named gv0 with 2 bricks on two nodes, add the following to your attributes/default.rb and include the gluster::server recipe:\n\n```\ndefault['gluster']['server']['brick_mount_path'] = \"/data\"\ndefault['gluster']['server']['volumes'] = {\n                'gv0' => {\n                        'peers' => ['gluster1.example.com','gluster2.example.com'],\n                        'replica_count' => 2,\n                        'volume_type' => \"replicated\"\n                }\n}\n```\n\nTo create a distributed-replicated volume with 4 bricks and a replica count of two:\n\n```\ndefault['gluster']['server']['brick_mount_path'] = \"/data\"\ndefault['gluster']['server']['volumes'] = {\n                'gv0' => {\n                        'peers' => ['gluster1.example.com','gluster2.example.com','gluster3.example.com','gluster4.example.com'],\n                        'replica_count' => 2,\n                        'volume_type' => \"distributed-replicated\"\n                }\n}\n```\n\nTo create a replicated volume with 4 bricks:\n\n```\ndefault['gluster']['server']['brick_mount_path'] = \"/data\"\ndefault['gluster']['server']['volumes'] = {\n                'gv0' => {\n                        'peers' => ['gluster1.example.com','gluster2.example.com','gluster3.example.com','gluster4.example.com'],\n                        'replica_count' => 4,\n                        'volume_type' => \"replicated\"\n                }\n}\n```\n\nFor clients, add the gluster::default or gluster::client recipe to the node's run list, and mount volumes using the `gluster_mount` LWRP. The Gluster volume will be mounted on the next chef-client run (provided the volume exists and is available) and added to /etc/fstab.\n\nThis cookbook cannot currently perform all the steps required for geo-replication but it can configure the mountbroker. The `gluster::mountbroker` recipe calls upon the `gluster::geo_replication_install` recipe to install the necessary package before configuring the mountbroker according to the `['gluster']['mountbroker']` attributes. User access can be defined via the attributes or you can use the `gluster_mountbroker_user` custom resource directly. Both the recipe and resource require Gluster 3.9 or later.\n\n## Testing\n\nThere is a kitchen file provided to allow testing of the various versions. Examples of tests are:\n\n(Depending on your shell, you may or may not need the \\ in the RegEx)\n\nTo test a replicated volume on Ubuntu 16.04:\nkitchen converge replicated\\[12]-ubuntu-1604\nkitchen verify replicated2-ubuntu-1604\n\nTo test a distributed-replicated volume on CentOS 7.2:\nkitchen converge distributed-repl\\[1234]-centos-72\nkitchen verify distributed-repl4-centos-72\n\nTo test a striped volume on CentOS 6.8:\nkitchen converge striped\\[12]-centos-68\nkitchen verify striped2-centos-68\n\nTo test a fuse client on Ubuntu 14.04:\nkitchen converge client\\[12]-ubuntu-1404\nkitchen verify client2-ubuntu-1404\n\nPlease note that at present the kitchen setup only supports Virtualbox\n",
  "maintainer": "Grant Ridder",
  "maintainer_email": "shortdudey123@gmail.com",
  "license": "Apache-2.0",
  "platforms": {
    "centos": ">= 0.0.0",
    "ubuntu": ">= 0.0.0"
  },
  "dependencies": {
    "compat_resource": ">= 12.14.6",
    "lvm": ">= 1.5.1"
  },
  "recommendations": {

  },
  "suggestions": {

  },
  "conflicting": {

  },
  "providing": {

  },
  "replacing": {

  },
  "attributes": {

  },
  "groupings": {

  },
  "recipes": {

  },
  "version": "6.2.0",
  "source_url": "https://github.com/shortdudey123/chef-gluster",
  "issues_url": "https://github.com/shortdudey123/chef-gluster/issues",
  "privacy": false,
  "chef_versions": [
    [
      ">= 12.1"
    ]
  ],
  "ohai_versions": [

  ],
  "gems": [

  ]
}
